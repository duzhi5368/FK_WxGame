function addBaseNode(){null==baseNode&&(baseNode=new Laya.Sprite,Laya.stage.addChild(baseNode))}function login(){null==userInfo&&wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(e){console.log("success",e.data),userInfo=e.data[0]},fail:function(e){console.log("fail",e.data)}})}function removeAllScore(){wx.removeUserCloudStorage({keyList:["score_"+Utils.getWeekNum()],success:function(e){console.log("removeAllScore success",e.data)},fail:function(e){console.log("removeAllScore fail",e.data)}})}function updateScore(e){wx.getUserCloudStorage({keyList:["score_"+Utils.getWeekNum()],fail:function(e){console.log(e)},success:function(a){var t=!1;if(0==a.KVDataList.length)t=!0,wx.removeUserCloudStorage({keyList:["score_"+(Utils.getWeekNum()-1)],success:function(e){console.log(e)},fail:function(e){console.log(e)}});else{var r=parseInt(a.KVDataList[0].value,10);e.score>=r&&(t=!0)}t?wx.setUserCloudStorage({KVDataList:[{key:"score_"+Utils.getWeekNum(),value:e.score.toString()}],success:function(e){console.log("update user score success"),showEndFriends(null)},fail:function(e){console.log("update user score fail")}}):showEndFriends(null)}})}function showEndFriends(e){console.log("showEndFriends"),wx.getFriendCloudStorage({keyList:["score_"+Utils.getWeekNum()],fail:function(e){console.log(e)},success:function(e){e.data=Utils.getValidData(e.data),e.data=Utils.scoreOrder(e.data);for(r=0;r<e.data.length;r++){if(e.data[r].nickname==userInfo.nickName){var a=new Array;if(0==r)for(t=0;t<3;t++){s=0;0==t?(s=r,a.push(s)):r+t<e.data.length&&(s=r+t,a.push(s))}else for(var t=0;t<3;t++){s=0;0==t&&r-1>=0&&(!0,s=r-1,a.push(s)),1==t&&(s=r,a.push(s)),2==t&&r+1<e.data.length&&(s=r+1,a.push(s))}for(var r=0;r<a.length;r++){var s=a[r],n=e.data[s],o=writeImage(e.data[s].avatarUrl,-280,0+-100*(1-r),60,60);o.anchorY=.5,Laya.stage.addChild(o);var i=writeImage("res/openDataRes/yuandi.png",-220,0+-100*(1-r),42,42);i.anchorY=.5,Laya.stage.addChild(i);var l=writeText((s+1).toString(),-220,0+-100*(1-r),260,600+90*r,120,30,30,"white","center");l.anchorY=.5,Laya.stage.addChild(l);var d=writeText(n.nickname,-130,0+-100*(1-r),260,600+90*r,120,30,30,"white","center");d.anchorY=.5,Laya.stage.addChild(d);var c=writeText(n.KVDataList[0].value,100,0+-100*(1-r),410,600+90*r,120,30,30,"#FFFFFF","left");c.anchorY=.5,Laya.stage.addChild(c);var u=parseInt(n.KVDataList[0].value,10),g=Utils.getTitleImgBySocre(u);if(""!=g){var h=writeImage("res/openDataRes/"+g,170,0+-100*(1-r),70,70);h.anchorY=.5,Laya.stage.addChild(h)}var f=writeText(Utils.getTitleDataBySocre(u).name,260,0+-100*(1-r),260,600+90*r,120,30,30,"#dbc17d","center");f.anchorY=.5,Laya.stage.addChild(f);var w=writeImage("res/openDataRes/img_line.png",0,40+-100*(1-r),583,3);w.anchorY=.5,Laya.stage.addChild(w)}break}}}})}function showFriendAvatar(e){wx.getFriendCloudStorage({keyList:["score_"+Utils.getWeekNum()],success:function(e){console.log(e.KVDataList),e.data=Utils.getValidData(e.data),e.data=Utils.scoreOrder(e.data);for(var a=0;a<e.data.length;a++){if(e.data[a].nickname==userInfo.nickName){if(0==a)console.log("你已经是最高名次");else{r=writeText("下一个即将超越好友：",100,1138,120,30,24,"white","center");Laya.stage.addChild(r);var t=writeImage(e.data[a-1].avatarUrl,402,1125,80,80);Laya.stage.addChild(t);var r=writeText(e.data[a-1].KVDataList[0].value,502,1138,120,50,40,"white","center");Laya.stage.addChild(r)}break}}}})}function showRank(e){wx.getFriendCloudStorage({keyList:["score_"+Utils.getWeekNum()],fail:function(e){console.log(e)},success:function(e){console.log("getFriendCloudStorage");var a=Utils.getValidData(e.data);a=Utils.scoreOrder(a);var t=new Laya.List;t.itemRender=RankItem,t.vScrollBarSkin="",t.repeatX=1,t.repeatY=5,t.array=a,t.centerX=0,t.centerY=0,t.size(577,636),t.renderHandler=new Laya.Handler(this,updateItem),Laya.stage.addChild(t)}})}function updateItem(e,a){e.init(e,a)}function writeImage(e,a,t,r,s){var n=new Laya.Image(e);return n.centerX=a,n.centerY=t,n.size(r,s),n}function writeText(e,a,t,r,s,n,o,i,l,d){var c=new Laya.Label;return c.text=e,c.width=n,c.height=o,c.valign="middle",c.fontSize=i,c.color=l,c.align=d,c.font="SimHei",c.bold=!1,c.x=r,c.y=s,c.centerX=a,c.centerY=t,c}function testData(e,a){for(var t=0;t<e;t++){var r={nickname:"zhou"+t,avatarUrl:"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoibM43W…T3LIAvEzibQO7FQsuibRVhmzoouePibWhfhicco11V0YQ/132",KVDataList:[{value:100+t}]};a.push(r)}return a}require("./weapp-adapter.js"),require("./libs/laya.core.js"),require("./libs/laya.wxmini.js"),require("./libs/laya.webgl.js"),require("./libs/laya.ani.js"),require("./libs/laya.ui.js"),require("./RankItem.js");var baseNode=null,userInfo=null;Laya.MiniAdpter.init(!0,!0),Laya.init(720,1280),Laya.stage.scaleMode="fixedauto",Laya.stage.screenMode="vertical",Laya.stage.alignH="center",Laya.stage.alignV="middle",Laya.stage.bgColor="#191514",login(),wx.onMessage(function(e){switch(login(),Laya.stage.removeChildren(),e.act){case"wxInit":console.log("-----------------sharedresize----------1------------------"),console.log(e.data.matrix),console.log("-----------------sharedresize------------2----------------"),e.data.matrix&&console.log(Laya.stage._canvasTransform);break;case"updateScore":updateScore(e);break;case"showRank":showRank(e);break;case"showFriendAvatar":showFriendAvatar(e);break;case"showEndFriends":showEndFriends(e);break;case"clearChildren":Laya.stage.removeChildren()}});